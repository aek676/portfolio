---
import Background3D from "./Background3D";
---

<div class="sky-container">
  <div class="cloud cloud-1"></div>
  <div class="cloud cloud-2"></div>
  <div class="cloud cloud-3"></div>
  <div class="cloud cloud-4"></div>
</div>

<Background3D client:only="react" />

<style>
  .sky-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: linear-gradient(
      var(--color-sky-top) 0%,
      var(--color-horizon) 60%,
      #4b3621 100%
    );
    z-index: -2;
    overflow: hidden;
    pointer-events: none;
  }

  .cloud {
    position: absolute;
    background: radial-gradient(
      ellipse at center,
      rgba(255, 255, 255, 1) 0%,
      rgba(255, 255, 255, 0) 70%
    );
    border-radius: 50%;
    filter: blur(10px);
    opacity: 0.95;
    animation: floatCloud linear infinite;
    will-change: transform;
    transform: translateZ(0); /* Forzar GPU acceleration */
  }

  /* Optimización para dispositivos bajos */
  .low-performance .cloud {
    filter: blur(5px); /* Reducir blur */
    animation-duration: 80s; /* Más lento */
  }

  .minimal-performance .cloud {
    filter: none; /* Sin blur */
    animation-duration: 120s; /* Mucho más lento */
  }

  /* Ocultar nubes según configuración */
  .cloud.hidden-medium,
  .cloud.hidden-low,
  .cloud.hidden-minimal {
    display: none;
  }

  /* Media queries para responsive */
  @media (max-width: 768px) {
    .cloud {
      animation-duration: 60s; /* Más lento en móvil */
    }
  }

  @media (max-width: 480px) {
    .cloud {
      filter: blur(5px);
      animation-duration: 80s;
    }
  }

  /* Fallback para dispositivos sin WebGL */
  .no-webgl .sky-container {
    background: linear-gradient(
      var(--color-sky-top) 0%,
      var(--color-horizon) 50%,
      #4b3621 100%
    );
  }

  .no-webgl .cloud {
    display: none;
  }

  /* Fallback minimal */
  .no-webgl.minimal-performance .sky-container {
    background: linear-gradient(
      var(--color-sky-top) 0%,
      var(--color-horizon) 100%
    );
  }

  .cloud-1 {
    width: 500px;
    height: 200px;
    top: 5%;
    left: -20%;
    animation-duration: 45s;
    animation-delay: 0s;
  }

  .cloud-2 {
    width: 700px;
    height: 300px;
    top: 15%;
    left: -20%;
    opacity: 0.6;
    animation-duration: 65s;
    animation-delay: -20s;
  }

  .cloud-3 {
    width: 300px;
    height: 150px;
    top: 25%;
    left: -10%;
    opacity: 0.5;
    animation-duration: 35s;
    animation-delay: -5s;
  }

  .cloud-4 {
    width: 600px;
    height: 250px;
    top: -5%;
    left: -10%;
    opacity: 0.7;
    animation-duration: 55s;
    animation-delay: -30s;
  }

  @keyframes floatCloud {
    from {
      transform: translateX(-100%);
    }
    to {
      transform: translateX(120vw);
    }
  }
</style>

<script>
  // Small utility to handle cloud visibility based on simple hardware check
  // This is a lightweight version of the previous performance detector
  function checkPerformance() {
    if (typeof window !== "undefined") {
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(
        navigator.userAgent,
      );
      const cores = navigator.hardwareConcurrency || 4;

      if (isMobile || cores < 4) {
        document.body.classList.add("low-performance");
        document
          .querySelector(".sky-container")
          ?.classList.add("low-performance");
      }
    }
  }

  // Run on load
  checkPerformance();
  // Run on astro page view (view transitions support if needed in future)
  document.addEventListener("astro:page-load", checkPerformance);
</script>
