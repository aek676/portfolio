---
import {
  NavigationMenu,
  NavigationMenuContent,
  NavigationMenuItem,
  NavigationMenuLink,
  NavigationMenuList,
  NavigationMenuTrigger,
} from "@/components/ui/navigation-menu";
import { languages } from "@/i18n/ui";
import { getUrl, useTranslations } from "@/i18n/utils";

const pathName = Astro.url.pathname;

const normalize = (s: string | undefined) => (s ? s.replace(/\/+$/, "") : "");

let currentLangPrefix = getUrl(Astro.currentLocale, "");

const purePath = pathName.replace(currentLangPrefix, "").replace(/^\//, "");

const t = useTranslations(Astro.currentLocale);
const homeUrl = getUrl(Astro.currentLocale);
const navItems = [
  { label: t("nav.home"), href: homeUrl },
  { label: t("nav.projects"), href: getUrl(Astro.currentLocale, "projects") },
  { label: t("nav.about"), href: getUrl(Astro.currentLocale, "about") },
];

const isHome = normalize(pathName) === normalize(homeUrl);

const logoClass =
  "text-2xl font-bold tracking-tighter italic hover:opacity-80 transition-opacity";
const desktopLinkClass =
  "uppercase tracking-widest hover:text-emerald-500 transition-colors bg-transparent hover:bg-transparent";
const mobileLinkClass =
  "text-xl uppercase tracking-widest font-semibold hover:text-emerald-500 transition-colors bg-transparent hover:bg-transparent";
const langSwitchClass =
  "uppercase font-bold hover:text-emerald-500 transition-colors bg-transparent hover:bg-transparent data-[state=open]:text-emerald-500";
---

<header
  class="fixed top-0 w-full z-50 p-6 flex justify-between items-center bg-(--color-glass-bg) backdrop-blur-md border-b border-(--color-glass-border) text-(--color-text-main) transition-all duration-300"
>
  {
    isHome ? (
      <span class={logoClass}>
        ANASS<span class="text-emerald-500">.</span>
      </span>
    ) : (
      <a href={homeUrl} class={logoClass}>
        ANASS<span class="text-emerald-500">.</span>
      </a>
    )
  }

  <NavigationMenu class="hidden md:flex absolute left-1/2 -translate-x-1/2">
    <NavigationMenuList class="gap-6">
      {
        navItems.map((item) => (
          <NavigationMenuItem>
            <NavigationMenuLink href={item.href} class={desktopLinkClass}>
              {item.label}
            </NavigationMenuLink>
          </NavigationMenuItem>
        ))
      }
    </NavigationMenuList>
  </NavigationMenu>

  <div class="flex items-center gap-4">
    <NavigationMenu>
      <NavigationMenuList>
        <NavigationMenuItem>
          <NavigationMenuTrigger class={langSwitchClass}>
            {Astro.currentLocale}
          </NavigationMenuTrigger>
          <NavigationMenuContent
            class="min-w-16 bg-(--color-glass-bg) backdrop-blur-xl border border-(--color-glass-border) p-2 shadow-xl rounded-md"
          >
            <ul class="flex flex-col gap-2 text-center">
              {
                Object.keys(languages).map((l) => (
                  <li>
                    <NavigationMenuLink
                      href={getUrl(l, purePath)}
                      class={`block px-2 py-1 uppercase text-sm hover:text-emerald-500 transition-colors ${l === Astro.currentLocale ? "text-emerald-500 font-bold" : ""}`}
                      aria-label={`${t("nav.changeLang")} ${l}`}
                    >
                      {l}
                    </NavigationMenuLink>
                  </li>
                ))
              }
            </ul>
          </NavigationMenuContent>
        </NavigationMenuItem>
      </NavigationMenuList>
    </NavigationMenu>

    <NavigationMenu class="md:hidden">
      <NavigationMenuList>
        <NavigationMenuItem class="static">
          <NavigationMenuTrigger
            class="text-2xl p-2 bg-transparent hover:bg-transparent focus:bg-transparent"
          >
            <span id="mobile-icon">â˜°</span>
          </NavigationMenuTrigger>
          <NavigationMenuContent
            class="fixed top-20 left-0 w-full h-auto bg-(--color-glass-bg) backdrop-blur-xl border-b border-(--color-glass-border) p-8 shadow-2xl transition-all duration-500 ease-in-out -translate-y-4 opacity-0 group-focus-within/navigation-menu-item:translate-y-0 group-focus-within/navigation-menu-item:opacity-100"
          >
            <ul class="flex flex-col items-center space-y-6">
              {
                navItems.map((item) => (
                  <li>
                    <NavigationMenuLink
                      href={item.href}
                      class={mobileLinkClass}
                    >
                      {item.label}
                    </NavigationMenuLink>
                  </li>
                ))
              }
            </ul>
          </NavigationMenuContent>
        </NavigationMenuItem>
      </NavigationMenuList>
    </NavigationMenu>
  </div>
</header>
