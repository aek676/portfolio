---
import {
  NavigationMenu,
  NavigationMenuContent,
  NavigationMenuItem,
  NavigationMenuLink,
  NavigationMenuList,
  NavigationMenuTrigger,
} from "@/components/ui/navigation-menu";
import type { Lang } from "@/i18n/ui";
import { useTranslations } from "@/i18n/utils";
import { getRelativeLocaleUrl } from "astro:i18n";

const pathName = Astro.url.pathname;
const lang = (Astro.currentLocale || "es") as Lang;

const normalize = (s: string | undefined) => (s ? s.replace(/\/+$/, "") : "");

const t = useTranslations(lang);
const homeUrl = getRelativeLocaleUrl(lang);
const navItems = [
  { label: t("nav.home"), href: homeUrl },
  { label: t("nav.projects"), href: getRelativeLocaleUrl(lang, "projects") },
  { label: t("nav.about"), href: getRelativeLocaleUrl(lang, "about") },
];

const isHome = normalize(pathName) === normalize(homeUrl);

const logoClass =
  "text-2xl font-bold tracking-tighter italic hover:opacity-80 transition-opacity";
const desktopLinkClass =
  "uppercase tracking-widest hover:text-emerald-500 transition-colors bg-transparent hover:bg-transparent";
const mobileLinkClass =
  "text-xl uppercase tracking-widest font-semibold hover:text-emerald-500 transition-colors bg-transparent hover:bg-transparent";
---

<header
  class="fixed top-0 w-full z-50 p-6 flex justify-between items-center bg-(--color-glass-bg) backdrop-blur-md border-b border-(--color-glass-border) text-(--color-text-main) transition-all duration-300"
>
  {
    isHome ? (
      <span class={logoClass}>
        ANASS<span class="text-emerald-500">.</span>
      </span>
    ) : (
      <a href={homeUrl} class={logoClass}>
        ANASS<span class="text-emerald-500">.</span>
      </a>
    )
  }

  <NavigationMenu class="hidden md:flex">
    <NavigationMenuList class="gap-6">
      {
        navItems.map((item) => (
          <NavigationMenuItem>
            <NavigationMenuLink
              href={item.href}
              variant="trigger"
              class={desktopLinkClass}
            >
              {item.label}
            </NavigationMenuLink>
          </NavigationMenuItem>
        ))
      }
    </NavigationMenuList>
  </NavigationMenu>

  <NavigationMenu class="md:hidden">
    <NavigationMenuList>
      <NavigationMenuItem class="static">
        <NavigationMenuTrigger
          class="text-2xl p-2 bg-transparent hover:bg-transparent focus:bg-transparent"
        >
          <span id="mobile-icon">â˜°</span>
        </NavigationMenuTrigger>
        <NavigationMenuContent
          class="fixed top-22 left-0 w-full h-auto bg-(--color-glass-bg) backdrop-blur-xl border-b border-(--color-glass-border) p-8 shadow-2xl transition-all duration-500 ease-in-out -translate-y-4 opacity-0 group-focus-within/navigation-menu-item:translate-y-0 group-focus-within/navigation-menu-item:opacity-100"
        >
          <ul class="flex flex-col items-center space-y-6">
            {
              navItems.map((item) => (
                <li>
                  <NavigationMenuLink href={item.href} class={mobileLinkClass}>
                    {item.label}
                  </NavigationMenuLink>
                </li>
              ))
            }
          </ul>
        </NavigationMenuContent>
      </NavigationMenuItem>
    </NavigationMenuList>
  </NavigationMenu>
</header>
